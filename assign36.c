#include <stdio.h>
#include <openssl/bn.h>
#define NBITS 256

void printBN(char * msg, BIGNUM * a)
{
    // Use BN_bn2hex(a) for hex string
    // Use BN_bn2dec(a) for decimal string
    char * number_str = BN_bn2hex(a);
    printf("%s %s\n", msg, number_str);
    OPENSSL_free(number_str);
}


int main ()
{
	// Setup; the variables needed
	BN_CTX *ctx = BN_CTX_new();

		// The CA's public key modulus
	BIGNUM *n = BN_new();
	BN_hex2bn(&n,"B77FA55928F2FB8CE3BE537F8E4757705B0A5FC1F49CBCF46D4246416370F634E9603D952FBB7566D403B1AD5942A892CAFAF6128CC1C32C369C65C3B6F78DE5C5831074F7F9E66A57005AD9CBCC5F8B6832840390D09AF2B3BA1D677C87EA1222824129975E1D3D5ECF9D3BB726E6A6DA2F686134909201E8DC8B072F38580536010C478DB09BA288147B105B6F23840FB5BBF334A7A7D5C117AE12065F2DF771F363F1D0B25C9379524F7101FC97DB76C74ECF3CE0E58918D5D7EEA9FF32E5F51E67B0B35976D38EE8F05FF4E8BE6796280DFA54B0B3EF96B35BAB4336E0E7EBA14EA400D967DA2655A17A06A34988B31597A3F7FDCD0E894302E99E4E7CA7");
	
		// The certificate ISSUER's public key

	BIGNUM *ipk = BN_new();
        BN_hex2bn(&ipk,"bf14689ff125e4ab88e2fc797b2d43826b189916349c37790a0e067c9f12f9b8");
	
		// The signaure on the certificate
	BIGNUM *s = BN_new();
        BN_hex2bn(&s,"4FAE2D9EDAEF16D21F19FFC710A1EA17946606725EAD7200B13C8E1B1AB9B11D2123A21272348A5E7A3FF9EF57201C371FEEC23C746884E1772ED137E931B5E2702881B535E258F3DBA00FA14BCC923E01FA4FDBC8879D526E47BD0C5ACA926908497609A3C8E1F8B7A0E85F7CC0727FD616D4210971CFA7BCBA7E1AD6E5965DBFC4743C0DF2423412D3C6F8E5ABDA8CEB6AC86B4157692AC16760BF2A850F8C896265307B4199C369B0CDB7DC34F6587C8F10D15E07C27F7054953742B69230CEB357AA9678BAB2BDB4ED6FF67D7B61284DCD82D6AFD6AE5F34694AB2614D8B99E166AF1E5B1121ABECFC81DB7862A762A45535E6E24A1089E30EBDD5B48BC3");
	
	// The hash of the certificate's body

	BIGNUM *certHash = BN_new();
 	BN_hex2bn(&certHash,"a1cd962d4764788dd2708fc5a164b45ec0b3221b98c7adff73e22e8db48aa828");
	
	// Verification of the signature

	BIGNUM *res = BN_new();
	BN_mod_exp(res, s, ipk, n, ctx);
	
	char *msg1 = "The signature to the power of the issuer's public key is: ";
        printBN(msg1, res);
	
	if (res == certHash){
		char *msg2 = "The signature to the power of the issuer's public key is equal to the certificate hash.";
		printf("%s", msg2);
	}
	else {
		char *msg2 = "The signature to the power of the issuer's public key is NOT equal to the certificate hash.";
		printf("%s", msg2);
	}

    return 0;

}
